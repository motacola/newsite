name: PR Validation

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Use Node.js 20.x
      uses: actions/setup-node@v4
      with:
        node-version: 20.x
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Run linting
      run: npm run lint

    - name: Run type checking
      run: npm run type-check

    - name: Run tests with coverage
      run: npm run test:coverage

    - name: Build application
      run: npm run build

    - name: Comment PR with build status
      uses: actions/github-script@v7
      if: always()
      with:
        script: |
          const { context } = require('@actions/github');
          const buildStatus = '${{ job.status }}' === 'success' ? '✅ Build successful' : '❌ Build failed';
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `## Build Status\n\n${buildStatus}\n\n- Linting: ${{ steps.lint.outcome || 'N/A' }}\n- Type checking: ${{ steps.type-check.outcome || 'N/A' }}\n- Tests: ${{ steps.test.outcome || 'N/A' }}\n- Build: ${{ steps.build.outcome || 'N/A' }}`
          });